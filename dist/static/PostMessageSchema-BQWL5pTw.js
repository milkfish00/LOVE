import{r as w,d as k,ay as D,d1 as q,u as U,cQ as C,cc as L,cR as V,bQ as B,d2 as Q,j as _,d3 as K,d4 as W,d5 as Y}from"./sanity-C0TwiKUV.js";function z(n){const{validation:e}=n.type;if(!e)return!1;const r=Array.isArray(e)?e:[e];for(const s of r){let p=!1;const c=new Proxy({},{get:(y,f)=>()=>(f==="required"&&(p=!0),c)});if(typeof s=="function"&&(s(c),p)||typeof s=="object"&&s!==null&&"_required"in s&&s._required==="required")return!0}return!1}function j(n,e){let r=n;for(;r;){if(r.name===e||r.type&&r.type.name===e)return!0;r=r.type}return!1}function G(n){return j(n,"object")||n.jsonType==="object"||"fields"in n}function H(n){return j(n,"array")}function E(n){return j(n,"reference")}function J(n){return j(n,"crossDatasetReference")}function X(n){return j(n,"string")}function Z(n){return j(n,"number")}function h(n){let e=n;for(;e;){if(!e.type)return e;e=e.type}}function F(n){return"fields"in n?n.type?F(n.type).concat(n.fields):n.fields:[]}function T(n){const e=new Set;function r(i,a){if(!e.has(i)){if(e.add(i),"fields"in i)for(const l of F(i)){const t=h(l.type);if(t.name==="document"){a.add(t);continue}let o;i.type.type?o=l.type.type.name:"jsonType"in i.type&&(o=l.type.jsonType),(o==="object"||o==="block")&&(E(l.type)?l.type.to.forEach(u=>a.add(u.type)):a.add(l.type)),r(l.type,a)}else if("of"in i)for(const l of i.of)r(l,a)}}const s=new Map;n.getTypeNames().forEach(i=>{const a=n.get(i);if(a===void 0||a.type===null)return;const l=new Set;r(a,l),s.set(a,l),e.clear()});const p=[],c=new Set,y=new Set;function f(i){if(y.has(i)||c.has(i))return;c.add(i);const a=s.get(i);a!==void 0&&a.forEach(l=>f(l)),c.delete(i),y.add(i),p.includes(i.name)||p.unshift(i.name)}for(const[i]of s)f(i);return p}const ee=function(n){const e=k.c(6),{schemaType:r,theme:s}=n,{theme:p,scheme:c,tone:y}=s;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=new K,e[0]=f):f=e[0];const i=f,a=r.icon;let l;return e[1]!==a||e[2]!==c||e[3]!==p||e[4]!==y?(l=a?_.jsx(W,{sheet:i.instance,children:_.jsx(Y,{theme:p,scheme:c,tone:y,children:w.isValidElement(a)?a:_.jsx(a,{})})}):null,e[1]=a,e[2]=c,e[3]=p,e[4]=y,e[5]=l):l=e[5],l},te=n=>({_id:{type:"objectField",name:"_id",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:n}},_createdAt:{type:"objectField",name:"_createdAt",value:{type:"string"}},_updatedAt:{type:"objectField",name:"_updatedAt",value:{type:"string"}},_rev:{type:"objectField",name:"_rev",value:{type:"string"}}});function ne(n){const e=n.options?.list;return e&&Array.isArray(e)?{type:"union",of:e.map(r=>({type:"string",value:typeof r=="string"?r:r.value}))}:{type:"string"}}function re(n){const e=n.options?.list;return e&&Array.isArray(e)?{type:"union",of:e.map(r=>({type:"number",value:typeof r=="number"?r:r.value}))}:{type:"number"}}function A(n,e=!1){const r={_ref:{type:"objectField",name:"_ref",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:"reference"}},_weak:{type:"objectField",name:"_weak",value:{type:"boolean"},optional:!0}};return e&&(r._key={type:"objectField",name:"_key",value:{type:"string"}}),{type:"object",fields:r,dereferencesTo:n}}function ie(n){const e=oe(n);return e.length===1?A(e[0]):{type:"union",of:e.map(r=>({type:"unionOption",name:r,value:A(r)}))}}function oe(n){const e=N(n);return[...new Set(e.map(r=>r.name))]}function N(n){const e="to"in n?n.to:[];return"type"in n&&E(n.type)?[...N(n.type),...e]:e}const S=new Map([["text",{type:"string"}],["url",{type:"string"}],["datetime",{type:"string"}],["date",{type:"string"}],["boolean",{type:"boolean"}],["email",{type:"string"}]]);function se(n,e){const r=new Set,{schema:s,basePath:p}=n;return T(s).map(t=>{const o=s.get(t);if(o===void 0)return;const u=y(o);if(u!==null)return u.type==="type"&&r.add(o),u}).filter(t=>t!==void 0);function c(t){if(t.icon)return Q.renderToString(_.jsx(ee,{schemaType:t,theme:e}))}function y(t){let o;if(t.type?o=t.type.name:"jsonType"in t&&(o=t.jsonType),o==="document"){const g=f(t);return g.type==="unknown"?null:{type:"document",name:t.name,title:typeof t.title=="string"?t.title:void 0,icon:c(t),fields:{...te(t.name),...g.fields}}}const u=i(t);return u.type==="unknown"?null:u.type==="object"?{name:t.name,type:"type",value:{type:"object",fields:{_type:{type:"objectField",name:"_type",value:{type:"string",value:t.name}},...u.fields}}}:{name:t.name,title:typeof t.title=="string"?t.title:void 0,type:"type",value:u}}function f(t){const o={};for(const u of F(t)){const g=i(u.type);g!==null&&(o[u.name]={type:"objectField",name:u.name,title:typeof u.type.title=="string"?u.type.title:void 0,value:g,optional:z(u)===!1})}return{type:"object",fields:o}}function i(t){if(h(t)?.name==="document")return A(t.name);if(r.has(t.type))return{type:"inline",name:t.type.name};if(t.type?.type?.name==="object")return{type:"inline",name:t.type.name};if(X(t))return ne(t);if(Z(t))return re(t);const o=S.get(t.type?.name||"");if(o)return o;if(t.type&&S.has(t.type.name))return S.get(t.type.name);if(J(t))return{type:"unknown"};if(E(t))return ie(t);if(H(t))return l(t);if(G(t))return f(t);throw new Error(`Type "${t.name}" not found`)}function a(t,o){const{options:u}=t;if(!u)return;const g={...u};return u.insertMenu&&(g.insertMenu={...u.insertMenu,views:u.insertMenu.views?.map(v=>v.name==="grid"?{name:"grid",previewImageUrls:v.previewImageUrl?o.reduce((d,{name:m})=>{const b=v.previewImageUrl?.(m);if(!b)return d;try{new URL(b),d[m]=b}catch{d[m]=new URL(b,`${window.location.origin}${p?`${p}/`:""}`).toString()}return d},{}):void 0}:v)}),g}function l(t){const o=[];for(const d of t.of){let m=i(d);const b={type:"unionOption",icon:c(d),name:d.name,title:typeof d.title=="string"?d.title:void 0,value:m};m.type==="inline"?m={type:"object",fields:{_key:x()},rest:m}:m.type==="object"&&(m.rest={type:"object",fields:{_key:x()}}),b.value=m,o.push(b)}if(o.length===0)return{type:"null"};if(o.length>1)return{type:"union",of:o,options:a(t,o)};const{name:u,title:g,value:v}=o[0];return{type:"array",of:{type:"arrayItem",name:u,title:typeof g=="string"?g:void 0,value:v}}}}function x(){return{type:"objectField",name:"_key",value:{type:"string"}}}function ae(n){const e=n.reduce((r,{id:s,path:p})=>(r[s]?r[s].add(p):r[s]=new Set([p]),r),{});return Object.entries(e)}function ue(n){const e=k.c(12),{comlink:r,perspective:s}=n,p=D(),c=q();let y,f;e[0]!==r||e[1]!==c||e[2]!==p?(y=()=>{try{const o=se(p,c);return r.post("presentation/schema",{schema:o}),r.on("visual-editing/schema",()=>({schema:o}))}catch{return}},f=[r,c,p],e[0]=r,e[1]=c,e[2]=p,e[3]=y,e[4]=f):(y=e[3],f=e[4]),w.useEffect(y,f);let i;e[5]!==s?(i=V(s)?C:{apiVersion:L},e[5]=s,e[6]=i):i=e[6];const a=U(i);let l,t;return e[7]!==a||e[8]!==r||e[9]!==s?(l=()=>r.on("visual-editing/schema-union-types",async o=>{const u=ae(o.paths),g=await Promise.all(u.map(async d=>{const[m,b]=d,R=Array.from(b),I=`*[_id == $id][0]{${R.map(pe).join(",")}}`,M=await a.fetch(I,{id:B(m)},{tag:"presentation-schema",perspective:s}),P=R.map((O,$)=>({path:O,type:M[$]}));return{id:m,paths:P}})),v=new Map;return g.forEach(d=>{v.set(d.id,new Map(d.paths.map(le)))}),{types:v}}),t=[r,a,s],e[7]=a,e[8]=r,e[9]=s,e[10]=l,e[11]=t):(l=e[10],t=e[11]),w.useEffect(l,t),null}function le(n){const{path:e,type:r}=n;return[e,r]}function pe(n,e){return`"${e}": ${n}[0]._type`}var fe=w.memo(ue);export{fe as default};
