import{aw as g,ax as P,r as s,cp as _,aK as S,cY as x,aZ as E,cZ as M,c_ as k,cJ as R,b4 as U,c$ as $,bQ as v,cX as j,d0 as y,cU as D,f as F}from"./sanity-k0Z9LVL5.js";function I(u){return g(function(t,r){var i=!1,n=0;t.subscribe(P(r,function(a){return(i||(i=!u(a,n++)))&&r.next(a)}))})}const O=u=>{const{comlink:t,refs:r,perspective:i}=u,n=_(),a=S(),c=s.useMemo(()=>new x,[]),d=s.useMemo(()=>c.asObservable().pipe(E(b=>k(b.map(e=>{const f={...e,_id:R(e._id)},m=i==="published"?U:n.observeForPreview(f,a.get(f._type)).pipe($(),I(o=>o.snapshot===null)),h={...e,_id:v(e._id)},w=n.observeForPreview(h,a.get(h._type));return j(w.pipe(y(m)),m).pipe(D(o=>!!o.snapshot),F(o=>{const p=o.snapshot;return{_id:v(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),M(0)),[n,c,a,i]),l=s.useRef([]);return s.useEffect(()=>{const b=d.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),l.current=e});return()=>{b.unsubscribe()}},[t,d]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:l.current})),[t]),s.useEffect(()=>{c.next(r)},[r,c]),null};var J=s.memo(O);export{J as default};
